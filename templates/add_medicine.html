{% extends "base.html" %}
{% block title %}Add Medicine{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='autosave.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='add_medicine.css') }}">
<div class="add-med-container">

  <!-- Header -->
  <div class="page-head" style="display:flex;flex-direction:column;gap:8px;">
    <h1 class="page-title page-title--cobalt">YOUR MEDICINES REMINDER</h1>

    <div class="autosave-card">
      <div class="autosave-left">
        <h3 class="autosave-title">Auto-Save</h3>
        <!-- Removed subtitle per request: "Automatically save changes as you type." -->
      </div>
    
      <div class="autosave-right">
          <label class="switch" aria-label="Auto-Save toggle">
            <input type="checkbox" id="autoSaveToggle" aria-label="Enable or disable automatic saving">
            <span class="slider round"></span>
          </label>
          <p id="autoSaveStatus" class="autosave-status autosave-on" aria-live="polite" role="status" aria-atomic="true">
            Saving automatically
          </p>
      </div>
    </div>
  </div>

  <form id="medicineForm" autocomplete="off" novalidate method="POST" action="{{ url_for('add_medicine') }}">

    <div id="medicineCards">

      <div class="medicine-card" data-index="0">
        <div class="medicine-card__header">
          <div class="medicine-card__title">
            <span class="pill-emoji">ðŸ’Š</span>
            <h3>Medicine 1</h3>
          </div>

          <div class="medicine-card__actions">
            <button type="button" class="action-box action-box--remove" title="Remove medicine" aria-label="Remove medicine">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="#E53935" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6zm2 3h2v9H5V9zm4 0h2v9H9V9zm4 0h2v9h-2V9zm4 0h2v9h-2V9zM9 2h6v2H9V2z" /></svg>
              <span class="action-text">Remove</span>
            </button>

            <button type="button" class="action-box action-box--toggle" aria-expanded="true" title="Toggle collapse" aria-label="Toggle collapse">
              <svg class="chev" width="14" height="14" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z" fill="#111"/></svg>
            </button>
          </div>
        </div>

        <div class="card-body">

          <label for="med-0-name" class="medicine-name-label">Medicine Name</label>
          <input id="med-0-name" type="text" name="med[0][name]" placeholder="eg - Vitamin C" required>

          <label for="med-0-dosage" class="dosage-label">Dosage</label>
          <input id="med-0-dosage" type="text" name="med[0][dosage]" placeholder="eg - 500 mg">

          <label class="medium-of-intake-label">Medium of intake</label>
          <div class="medium-group" role="list">
            <label class="medium-option" data-value="Tablet" data-color="blue">
              <input type="radio" name="med[0][medium]" value="Tablet"/>
              <span class="medium-color" style="background:#4c8bfd"></span>
              <span class="medium-icon">ðŸ’Š</span>
              <span class="medium-label">Tablet</span>
            </label>

            <label class="medium-option" data-value="Capsule" data-color="red">
              <input type="radio" name="med[0][medium]" value="Capsule"/>
              <span class="medium-color" style="background:#ff6b6b"></span>
              <span class="medium-icon">ðŸŸ£</span>
              <span class="medium-label">Capsule</span>
            </label>

            <label class="medium-option" data-value="Syrup" data-color="green">
              <input type="radio" name="med[0][medium]" value="Syrup"/>
              <span class="medium-color" style="background:#28c76f"></span>
              <span class="medium-icon">ðŸ§´</span>
              <span class="medium-label">Syrup</span>
            </label>

            <label class="medium-option" data-value="Drops" data-color="yellow">
              <input type="radio" name="med[0][medium]" value="Drops"/>
              <span class="medium-color" style="background:#f8d047"></span>
              <span class="medium-icon">ðŸ’§</span>
              <span class="medium-label">Drops</span>
            </label>

            <label class="medium-option" data-value="Injection" data-color="purple">
              <input type="radio" name="med[0][medium]" value="Injection"/>
              <span class="medium-color" style="background:#b37eff"></span>
              <span class="medium-icon">ðŸ’‰</span>
              <span class="medium-label">Injection</span>
            </label>
          </div>

          <label for="med-0-quantity" class="quantity-label">Quantity of Intake per Dose</label>
          <input id="med-0-quantity" type="number" name="med[0][quantity]" value="1" min="1">

          <!-- WHEN SHOULD THIS BE TAKEN (icon-based with chevron only) -->
          <label class="when-taken-label">When should this be taken?</label>
          <div class="meal-group" role="radiogroup" aria-label="When to take medicine">
            <div class="meal-option">
              <input class="meal-input" type="radio" id="food-before" name="med[0][food]" value="Before Food">
              <label for="food-before" class="meal-card">
                <img src="https://images.unsplash.com/photo-1579613832125-5d34a13ffe2a?w=50" alt="Before meal" class="meal-icon">
                <div class="meal-label">Before Meal</div>
              </label>
              <div id="meal-info-before" class="meal-info" hidden>Take 15â€“30 min before meals.</div>
            </div>

            <div class="meal-option">
              <input class="meal-input" type="radio" id="food-after" name="med[0][food]" value="After Food">
              <label for="food-after" class="meal-card">
                <img src="https://images.unsplash.com/photo-1567306226416-28f0efdc88ce?w=50" alt="After meal" class="meal-icon">
                <div class="meal-label">After Meal</div>
              </label>
              <div id="meal-info-after" class="meal-info" hidden>Take immediately after eating.</div>
            </div>

            <div class="meal-option">
              <input class="meal-input" type="radio" id="food-none" name="med[0][food]" value="No preference" checked>
              <label for="food-none" class="meal-card">
                <div class="meal-label">Any Time</div>
              </label>
              <div id="meal-info-any" class="meal-info" hidden>This medicine can be taken any time.</div>
            </div>
          </div>

          <!-- TIME OF DAY icons + checkboxes -->
          <label class="mt-3 time-of-day-label">Time of Day (select all that apply)</label>
          <div class="tod-pics">
            <label class="tod-item">
              <input type="checkbox" name="med[0][tod][]" value="Morning" data-default-time="08:00">
              <img src="https://plus.unsplash.com/premium_photo-1676320526001-07b75bd19ae3?w=50" alt="Morning">
              <div class="tod-label">Morning</div>
              <span class="time-input-container"></span>
            </label>

            <label class="tod-item">
              <input type="checkbox" name="med[0][tod][]" value="Afternoon" data-default-time="13:00">
              <img src="https://images.unsplash.com/photo-1604064412467-af16406b5ba5?w=50" alt="Afternoon">
              <div class="tod-label">Afternoon</div>
              <span class="time-input-container"></span>
            </label>

            <label class="tod-item">
              <input type="checkbox" name="med[0][tod][]" value="Evening" data-default-time="18:00">
              <img src="https://plus.unsplash.com/premium_photo-1675714692853-08041b09df01?w=50" alt="Evening">
              <div class="tod-label">Evening</div>
              <span class="time-input-container"></span>
            </label>

            <label class="tod-item">
              <input type="checkbox" name="med[0][tod][]" value="Night" data-default-time="22:00">
              <img src="https://images.unsplash.com/photo-1532767153582-b1a0e5145009?w=50" alt="Night">
              <div class="tod-label">Night</div>
              <span class="time-input-container"></span>
            </label>
          </div>

          <label for="med-0-notes">Notes (optional)</label>
          <textarea id="med-0-notes" name="med[0][notes]" placeholder="Any additional instructions..."></textarea>

          <div class="manual-save-wrapper">
            <button type="button" class="manual-save-btn">Save</button>
          </div>

        </div> <!-- card-body -->

      </div> <!-- medicine-card -->

    </div> <!-- medicineCards -->

    <div class="bottom-actions">
      <button type="button" id="addAnotherBtn" class="add-btn">âž• Add Another</button>
      <button type="submit" id="nextBtn" class="next-btn">Next â†’ Schedule</button>
    </div>

  </form>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='add_medicine.js') }}"></script>
<script src="{{ url_for('static', filename='autosave.js') }}"></script>
{% endblock %}
